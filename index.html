<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.O.L - Close-up 3D</title>
    <style>
        :root { --pink: #ff477e; --bg: #fdf2f8; --wall: #ffffff; }
        body { margin: 0; background: var(--bg); font-family: sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; align-items: center; }

        /* çŠ¶æ€æ  */
        .hud { width: 92%; margin-top: 10px; padding: 12px; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 20px; display: flex; justify-content: space-around; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .hud-val { display: block; font-weight: 900; color: var(--pink); }
        .hud-label { font-size: 0.6rem; color: #999; }

        /* 3D å®¹å™¨ - å…³é”®ï¼šå¢åŠ  perspective æ·±åº¦ */
        #stage { 
            flex: 1; width: 100%; overflow: hidden; 
            perspective: 600px; /* é™ä½æ•°å€¼ä¼šè®©é€è§†æ›´å¼ºï¼Œè§†è§’æ›´çª„ */
            display: flex; align-items: center; justify-content: center;
        }
        
        #world { 
            position: relative; transform-style: preserve-3d;
            /* æ›´åŠ ä½å¹³çš„è§†è§’ï¼šrotateX ä» 55 å¢åŠ åˆ° 65 */
            transform: rotateX(65deg) rotateZ(-30deg); 
            transition: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .block { position: absolute; transform-style: preserve-3d; width: 50px; height: 50px; }
        .face { position: absolute; width: 100%; height: 100%; }
        .top { background: #fff; transform: translateZ(30px); border: 1px solid #fce7f3; }
        .side { background: #fce7f3; height: 30px; transform: rotateX(-90deg); transform-origin: bottom; bottom: 0; filter: brightness(0.9); }
        .side-r { background: #fce7f3; width: 30px; transform: rotateY(90deg); transform-origin: left; left: 0; filter: brightness(0.85); }

        .path { background: #fff; transform: translateZ(0); }
        .goal { background: #fbbf24; transform: translateZ(2px); box-shadow: 0 0 20px #fbbf24; }

        /* è§’è‰²ï¼šç«‹ç‰Œæ„Ÿ */
        #hero {
            position: absolute; width: 40px; height: 40px;
            transform-style: preserve-3d;
            transform: rotateX(-90deg) rotateY(30deg) translateZ(25px);
            transition: 0.2s; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; border-radius: 10px;
        }

        /* æŒ‰é’® */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 30px; z-index: 1000; }
        .btn { width: 60px; height: 60px; background: white; border-radius: 20px; border: none; font-size: 1.5rem; color: var(--pink); box-shadow: 0 6px 0 #eee; }
        .btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #eee; }
    </style>
</head>
<body>

    <div class="hud">
        <div class="hud-item"><span class="hud-label">LEVEL</span><span id="lv" class="hud-val">1</span></div>
        <div class="hud-item"><span class="hud-label">TIME</span><span id="tm" class="hud-val">00:00</span></div>
    </div>

    <div id="stage">
        <div id="world"></div>
    </div>

    <div class="controls">
        <div></div><button class="btn" onclick="move('u')">â†‘</button><div></div>
        <button class="btn" onclick="move('l')">â†</button>
        <button class="btn" onclick="move('d')">â†“</button>
        <button class="btn" onclick="move('r')">â†’</button>
    </div>

<script>
    const world = document.getElementById('world');
    let state = { lv: 1, pos: {x:1, y:1}, maze: [], size: 50 };

    function createMaze() {
        const dim = 15; // å›ºå®šè¿·å®«å¤§å°ï¼Œä½†è§†é‡å˜çª„åæ„Ÿè§‰ä¼šå¤§å¾ˆå¤š
        state.maze = Array.from({length:dim}, () => Array(dim).fill(1));
        const walk = (x, y) => {
            state.maze[x][y] = 0;
            [[0,2],[0,-2],[2,0],[-2,0]].sort(()=>Math.random()-0.5).forEach(([dx,dy])=>{
                if(x+dx>0 && x+dx<dim-1 && y+dy>0 && y+dy<dim-1 && state.maze[x+dx][y+dy]==1){
                    state.maze[x+dx/2][y+dy/2]=0; walk(x+dx, y+dy);
                }
            });
        };
        walk(1,1);
        render();
    }

    function render() {
        world.innerHTML = '';
        const dim = state.maze.length;
        state.maze.forEach((row, r) => {
            row.forEach((v, c) => {
                const el = document.createElement('div');
                el.className = 'block ' + (v ? 'wall' : 'path');
                el.style.left = c * state.size + 'px';
                el.style.top = r * state.size + 'px';
                if(v) el.innerHTML = '<div class="face top"></div><div class="face side"></div><div class="face side-r"></div>';
                if(r === dim-2 && c === dim-2) el.classList.add('goal');
                world.appendChild(el);
            });
        });
        const h = document.createElement('div');
        h.id = 'hero'; h.innerHTML = 'ğŸ˜ˆ';
        h.style.background = '#ff92ac';
        world.appendChild(h);
        updateView();
    }

    function updateView() {
        const h = document.getElementById('hero');
        const x = state.pos.x * state.size;
        const y = state.pos.y * state.size;
        h.style.left = y + 5 + 'px';
        h.style.top = x + 5 + 'px';

        // æ ¸å¿ƒé€»è¾‘ï¼šç§»åŠ¨æ•´ä¸ªä¸–ç•Œï¼Œè®©è§’è‰²å§‹ç»ˆå±…ä¸­
        // é€šè¿‡è´Ÿä½ç§»å®ç°â€œè·Ÿéšæ‘„åƒæœºâ€æ•ˆæœ
        const offsetX = -y;
        const offsetY = -x;
        world.style.transform = `rotateX(65deg) rotateZ(-30deg) translate3d(${offsetX}px, ${offsetY}px, 0)`;
    }

    window.move = (d) => {
        let {x, y} = state.pos;
        if(d=='u') x--; if(d=='d') x++; if(d=='l') y--; if(d=='r') y++;
        if(state.maze[x] && state.maze[x][y] === 0) {
            state.pos = {x, y};
            updateView();
            if(x === state.maze.length-2 && y === state.maze.length-2) {
                state.lv++; document.getElementById('lv').innerText = state.lv;
                createMaze(); state.pos = {x:1, y:1}; updateView();
            }
        }
    };

    createMaze();
</script>
</body>
</html>
