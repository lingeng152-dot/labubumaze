<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.O.L 3D - Maze of Labubu</title>
    <style>
        :root { --pink: #ff477e; --bg: #f3e8ff; --wall: #ffffff; --floor: #fff0f5; }
        body { margin: 0; padding: 0; background: var(--bg); font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; perspective: 1200px; }

        /* é¡¶éƒ¨ HUD */
        .hud { width: 90%; margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.7); backdrop-filter: blur(15px); border-radius: 20px; display: flex; justify-content: space-around; box-shadow: 0 8px 32px rgba(0,0,0,0.05); z-index: 100; border: 1px solid white; }
        .hud-item { text-align: center; }
        .hud-val { display: block; font-weight: 900; color: var(--pink); font-size: 1.1rem; }
        .hud-label { font-size: 0.6rem; color: #999; }

        /* 3D èˆå°å®¹å™¨ */
        #stage { flex: 1; width: 100%; display: flex; align-items: center; justify-content: center; transform-style: preserve-3d; }
        
        /* è¿·å®«å®¹å™¨ - å€¾æ–œ 3D æ•ˆæœ */
        #maze-container { 
            position: relative; 
            transform-style: preserve-3d; 
            transform: rotateX(45deg) rotateZ(-25deg); 
            transition: 0.5s ease;
        }

        .cell { 
            position: absolute; width: 40px; height: 40px; 
            transform-style: preserve-3d;
        }

        /* 3D å¢™å£ï¼šåšæˆæ–¹å—æ„Ÿ */
        .wall { 
            background: var(--wall); 
            box-shadow: inset 0 0 10px rgba(255,71,126,0.1);
        }
        .wall::before { /* ä¾§é¢æ·±åº¦ */
            content: ''; position: absolute; width: 100%; height: 20px; 
            background: #eee; transform: rotateX(-90deg) translateY(-10px); top: 0;
        }
        .wall::after { /* å¦ä¸€ä¸ªä¾§é¢ */
            content: ''; position: absolute; width: 20px; height: 100%; 
            background: #ddd; transform: rotateY(90deg) translateX(10px); left: 0;
        }

        /* åœ°æ¿ */
        .path { background: var(--floor); box-shadow: inset 0 0 5px rgba(0,0,0,0.02); }

        /* 3D è§’è‰² - å°±åƒæµ·æŠ¥é‡Œçš„å…¬ä»”ç«‹ç‰Œ */
        #player {
            position: absolute; width: 34px; height: 34px;
            background-size: contain; background-repeat: no-repeat;
            background-position: center bottom;
            transform: rotateX(-45deg) rotateZ(25deg) translateZ(20px);
            transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 15px 10px rgba(0,0,0,0.2));
            z-index: 10;
        }

        /* æ“ä½œæŒ‰é’® */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 40px; z-index: 100; }
        .joy-btn { width: 60px; height: 60px; background: white; border-radius: 20px; border: none; font-size: 1.5rem; color: var(--pink); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        /* èœå•é€‰äºº */
        .overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .char-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .char-item { width: 80px; padding: 10px; background: white; border-radius: 15px; border: 2px solid #eee; text-align: center; font-size: 0.6rem; }
        .char-item.active { border-color: var(--pink); background: #fff1f5; }
    </style>
</head>
<body>

    <div class="hud">
        <div class="hud-item"><span class="hud-label">LV.</span><span id="lvD" class="hud-val">1</span></div>
        <div class="hud-item"><span class="hud-label">TIME</span><span id="tmD" class="hud-val">00:00</span></div>
        <div class="hud-item"><span class="hud-label">HERO</span><span id="hrD" class="hud-val">å¿ƒåŠ¨ç²‰</span></div>
    </div>

    <div id="stage">
        <div id="maze-container"></div>
    </div>

    <div class="controls">
        <div></div><button class="joy-btn" onclick="move('u')">â†‘</button><div></div>
        <button class="joy-btn" onclick="move('l')">â†</button>
        <button class="joy-btn" onclick="move('d')">â†“</button>
        <button class="joy-btn" onclick="move('r')">â†’</button>
    </div>

    <div id="menu" class="overlay">
        <h1 style="color:var(--pink); font-size:3rem; margin:0;">M.O.L 3D</h1>
        <div class="char-grid" id="charGrid"></div>
        <button onclick="start()" style="background:var(--pink); color:white; border:none; padding:15px 60px; border-radius:30px; font-weight:bold;">ENTER BOX</button>
    </div>

<script>
    const container = document.getElementById('maze-container');
    const roles = {
        pink: { name: 'å¿ƒåŠ¨ç²‰', color: '#ff92ac', icon: 'ğŸ˜ˆ' },
        green: { name: 'å¹³é™ç»¿', color: '#a8e6cf', icon: 'ğŸ¦–' },
        blue: { name: 'å¸Œæœ›è“', color: '#a2d2ff', icon: 'ğŸ’' },
        zimomo: { name: 'æœ¬æˆ‘(ID)', color: '#444444', icon: 'ğŸ‘‘', locked: true }
    };

    let state = { level: 1, char: 'pink', pos: {x:1, y:1}, maze: [] };
    const size = 40;

    function renderMenu() {
        const grid = document.getElementById('charGrid');
        grid.innerHTML = '';
        Object.keys(roles).forEach(k => {
            const r = roles[k];
            const div = document.createElement('div');
            div.className = `char-item ${state.char === k ? 'active' : ''}`;
            div.innerHTML = `<div style="font-size:1.5rem">${r.icon}</div>${r.name}`;
            div.onclick = () => { state.char = k; renderMenu(); };
            grid.appendChild(div);
        });
    }

    function createMaze(dim) {
        let m = Array.from({length:dim}, () => Array(dim).fill(1));
        const walk = (x, y) => {
            m[x][y] = 0;
            [[0,2],[0,-2],[2,0],[-2,0]].sort(()=>Math.random()-0.5).forEach(([dx,dy])=>{
                let nx=x+dx, ny=y+dy;
                if(nx>0 && nx<dim-1 && ny>0 && ny<dim-1 && m[nx][ny]==1){
                    m[x+dx/2][y+dy/2]=0; walk(nx, ny);
                }
            });
        };
        walk(1,1);
        return m;
    }

    function drawMaze() {
        container.innerHTML = '';
        const dim = state.maze.length;
        container.style.width = container.style.height = `${dim * size}px`;
        
        for(let r=0; r<dim; r++) {
            for(let c=0; c<dim; c++) {
                const cell = document.createElement('div');
                cell.className = `cell ${state.maze[r][c] ? 'wall' : 'path'}`;
                cell.style.left = `${c * size}px`;
                cell.style.top = `${r * size}px`;
                if(r === dim-2 && c === dim-2) cell.style.background = '#fbbf24';
                container.appendChild(cell);
            }
        }
        
        const p = document.createElement('div');
        p.id = 'player';
        p.style.backgroundColor = roles[state.char].color;
        // å…³é”®ï¼šè¿™é‡Œç›´æ¥æ”¾ä¸€ä¸ªå ä½ç¬¦ï¼Œä½ å¯ä»¥æŠŠèƒŒæ™¯å›¾æ¢æˆæµ·æŠ¥é‡Œçš„ Labubu
        p.innerText = roles[state.char].icon;
        p.style.fontSize = "24px";
        p.style.display = "flex";
        p.style.alignItems = "center";
        p.style.justifyContent = "center";
        p.style.borderRadius = "10px";
        container.appendChild(p);
        updatePlayer();
    }

    function updatePlayer() {
        const p = document.getElementById('player');
        p.style.left = `${state.pos.y * size + 3}px`;
        p.style.top = `${state.pos.x * size + 3}px`;
    }

    window.move = (d) => {
        let {x, y} = state.pos;
        if(d=='u') x--; if(d=='d') x++; if(d=='l') y--; if(d=='r') y++;
        if(state.maze[x] && state.maze[x][y] === 0) {
            state.pos = {x, y};
            updatePlayer();
            if(x === state.maze.length-2 && y === state.maze.length-2) {
                state.level++;
                document.getElementById('lvD').innerText = state.level;
                start();
            }
        }
    };

    function start() {
        document.getElementById('menu').style.display = 'none';
        state.maze = createMaze(11 + Math.min(state.level*2, 20));
        state.pos = {x:1, y:1};
        drawMaze();
    }

    renderMenu();
</script>
</body>
</html>
